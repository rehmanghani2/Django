{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <h2>Pay Your Fees via Stripe</h2>
    <form id="payment-form" method="POST">
        {% csrf_token %}
        <select id="feeSelect" name="fee_id" class="form-control my-3">
            {% for fee in fee_structures %}
                <option value="{{ fee.id }}">{{ fee.fee_type }} - ${{ fee.amount }}</option>
            {% endfor %}
        </select>
        <button id="checkout-button" class="btn btn-primary">Pay with Card</button>
    </form>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    {% comment %} const stripe = Stripe('{{ stripe_public_key }}'); {% endcomment %}

    const checkoutButton = document.getElementById('checkout-button');
    checkoutButton.addEventListener('click', function(e) {
        e.preventDefault();
        const feeId = document.getElementById('feeSelect').value;

        fetch("{% url 'create_checkout_session' %}", {
            method: "POST",
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: new URLSearchParams({ 'fee_id': feeId })
        })
        .then(response => response.json())
        .then(data => {
            stripe.redirectToCheckout({ sessionId: data.id });
        });
    });
</script>
{% endblock %}
